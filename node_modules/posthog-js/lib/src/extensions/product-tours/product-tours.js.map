{"version":3,"file":"product-tours.js","sourceRoot":"","sources":["../../../../src/extensions/product-tours/product-tours.tsx"],"names":[],"mappings":"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","sourcesContent":["import { render } from 'preact'\nimport { PostHog } from '../../posthog-core'\nimport {\n    ProductTour,\n    ProductTourCallback,\n    ProductTourDismissReason,\n    ProductTourRenderReason,\n    ShowTourOptions,\n} from '../../posthog-product-tours-types'\nimport { SurveyEventName, SurveyEventProperties } from '../../posthog-surveys-types'\nimport {\n    addProductTourCSSVariablesToElement,\n    findElementBySelector,\n    getElementMetadata,\n    getProductTourStylesheet,\n    normalizeUrl,\n} from './product-tours-utils'\nimport { ProductTourTooltip } from './components/ProductTourTooltip'\nimport { createLogger } from '../../utils/logger'\nimport { document as _document, window as _window } from '../../utils/globals'\nimport { localStore } from '../../storage'\nimport { addEventListener } from '../../utils'\nimport { isNull, SurveyMatchType } from '@posthog/core'\nimport { propertyComparisons } from '../../utils/property-utils'\nimport { TOUR_COMPLETED_KEY_PREFIX, TOUR_DISMISSED_KEY_PREFIX } from './constants'\nimport { doesTourActivateByAction, doesTourActivateByEvent } from '../../utils/product-tour-utils'\nimport { TOOLBAR_ID } from '../../constants'\nimport { ProductTourEventReceiver } from '../../utils/product-tour-event-receiver'\n\nconst logger = createLogger('[Product Tours]')\n\nconst document = _document as Document\nconst window = _window as Window & typeof globalThis\n\n// Tour condition checking - reuses the same URL matching logic as surveys\nfunction doesTourUrlMatch(tour: ProductTour): boolean {\n    const conditions = tour.conditions\n    if (!conditions?.url) {\n        return true\n    }\n\n    const href = window?.location?.href\n    if (!href) {\n        return false\n    }\n\n    const matchType = conditions.urlMatchType || SurveyMatchType.Icontains\n\n    if (matchType === SurveyMatchType.Exact) {\n        return normalizeUrl(href) === normalizeUrl(conditions.url)\n    }\n\n    const targets = [conditions.url]\n    return propertyComparisons[matchType](targets, [href])\n}\n\nfunction isTourInDateRange(tour: ProductTour): boolean {\n    const now = new Date()\n\n    if (tour.start_date) {\n        const startDate = new Date(tour.start_date)\n        if (now < startDate) {\n            return false\n        }\n    }\n\n    if (tour.end_date) {\n        const endDate = new Date(tour.end_date)\n        if (now > endDate) {\n            return false\n        }\n    }\n\n    return true\n}\n\nfunction checkTourConditions(tour: ProductTour): boolean {\n    return isTourInDateRange(tour) && doesTourUrlMatch(tour)\n}\n\nconst CONTAINER_CLASS = 'ph-product-tour-container'\nconst TRIGGER_LISTENER_ATTRIBUTE = 'data-ph-tour-trigger'\nconst CHECK_INTERVAL_MS = 1000\n\ninterface TriggerListenerData {\n    element: Element\n    listener: (event: Event) => void\n    tour: ProductTour\n}\n\nfunction retrieveTourShadow(tour: ProductTour): { shadow: ShadowRoot; isNewlyCreated: boolean } {\n    const containerClass = `${CONTAINER_CLASS}-${tour.id}`\n    const existingDiv = document.querySelector(`.${containerClass}`)\n\n    if (existingDiv && existingDiv.shadowRoot) {\n        return {\n            shadow: existingDiv.shadowRoot,\n            isNewlyCreated: false,\n        }\n    }\n\n    const div = document.createElement('div')\n    div.className = containerClass\n\n    addProductTourCSSVariablesToElement(div, tour.appearance)\n\n    const shadow = div.attachShadow({ mode: 'open' })\n\n    const stylesheet = getProductTourStylesheet()\n    if (stylesheet) {\n        shadow.appendChild(stylesheet)\n    }\n\n    document.body.appendChild(div)\n\n    return {\n        shadow,\n        isNewlyCreated: true,\n    }\n}\n\nfunction removeTourFromDom(tourId: string): void {\n    const containerClass = `${CONTAINER_CLASS}-${tourId}`\n    const container = document.querySelector(`.${containerClass}`)\n    if (container?.shadowRoot) {\n        render(null, container.shadowRoot)\n    }\n    container?.remove()\n}\n\nexport class ProductTourManager {\n    private _instance: PostHog\n    private _activeTour: ProductTour | null = null\n    private _currentStepIndex: number = 0\n    private _isPreviewMode: boolean = false\n    private _checkInterval: ReturnType<typeof setInterval> | null = null\n    private _triggerSelectorListeners: Map<string, TriggerListenerData> = new Map()\n    private _pendingTourTimeouts: Map<string, ReturnType<typeof setTimeout>> = new Map()\n    private _eventReceiver: ProductTourEventReceiver\n    private _registeredEventTourIds: Set<string> = new Set()\n\n    constructor(instance: PostHog) {\n        this._instance = instance\n        this._eventReceiver = new ProductTourEventReceiver(instance)\n    }\n\n    start(): void {\n        if (this._checkInterval) {\n            return\n        }\n\n        this._checkInterval = setInterval(() => {\n            this._evaluateAndDisplayTours()\n        }, CHECK_INTERVAL_MS)\n\n        this._evaluateAndDisplayTours()\n        addEventListener(document, 'visibilitychange', this._handleVisibilityChange)\n    }\n\n    stop(): void {\n        if (this._checkInterval) {\n            clearInterval(this._checkInterval)\n            this._checkInterval = null\n        }\n        document.removeEventListener('visibilitychange', this._handleVisibilityChange)\n        this._removeAllTriggerListeners()\n        this._cancelAllPendingTours()\n        this._cleanup()\n    }\n\n    private _handleVisibilityChange = (): void => {\n        if (document.hidden && this._checkInterval) {\n            clearInterval(this._checkInterval)\n            this._checkInterval = null\n        } else if (!document.hidden && !this._checkInterval) {\n            this._checkInterval = setInterval(() => {\n                this._evaluateAndDisplayTours()\n            }, CHECK_INTERVAL_MS)\n            this._evaluateAndDisplayTours()\n        }\n    }\n\n    private _evaluateAndDisplayTours(): void {\n        if (document?.getElementById(TOOLBAR_ID)) {\n            return\n        }\n\n        // Use getProductTours (not getActiveProductTours) because selector-triggered tours\n        // should work even if completed/dismissed\n        this._instance.productTours?.getProductTours((tours) => {\n            if (tours.length === 0) {\n                this._removeAllTriggerListeners()\n                return\n            }\n\n            const activeTriggerTourIds = new Set<string>()\n\n            const unregisteredEventTours = tours.filter(\n                (tour: ProductTour) =>\n                    !this._registeredEventTourIds.has(tour.id) &&\n                    (doesTourActivateByEvent(tour) || doesTourActivateByAction(tour))\n            )\n            if (unregisteredEventTours.length > 0) {\n                this._eventReceiver.register(unregisteredEventTours)\n                unregisteredEventTours.forEach((tour) => this._registeredEventTourIds.add(tour.id))\n            }\n\n            const eventActivatedTourIds = this._activeTour ? [] : this._eventReceiver.getTours()\n\n            /**\n             * tours can be shown three ways, really:\n             *\n             * 1) selector clicks\n             * 2a) auto-show immediately\n             * 2b) auto-show after event/action\n             *\n             * (1) and (2[a|b]) are fully independent of each other\n             */\n            for (const tour of tours) {\n                // 1) SELECTOR CLICK TRIGGER - just attach an event listener and keep going\n                const triggerSelector = tour.conditions?.selector\n                if (triggerSelector) {\n                    activeTriggerTourIds.add(tour.id)\n                    this._manageTriggerSelectorListener(tour, triggerSelector)\n                }\n\n                // skip auto-launch checks if a tour is already active\n                if (this._activeTour) {\n                    continue\n                }\n\n                // 2) AUTO-LAUNCH\n                const hasEventOrActionTriggers = doesTourActivateByAction(tour) || doesTourActivateByEvent(tour)\n\n                if (tour.auto_launch && this._isTourEligible(tour)) {\n                    // tour should auto-launch, and the current session is eligible\n\n                    if (!hasEventOrActionTriggers) {\n                        // 2a) AUTO-SHOW WITH NO EVENT/ACTION\n                        this._showOrQueueTour(tour, 'auto')\n                        continue\n                    }\n\n                    // 2b) AUTO-SHOW, BUT WAIT FOR EVENT/ACTION\n                    if (eventActivatedTourIds.includes(tour.id)) {\n                        this._showOrQueueTour(tour, 'event')\n                    }\n                }\n            }\n\n            this._triggerSelectorListeners.forEach(({ tour }) => {\n                if (!activeTriggerTourIds.has(tour.id)) {\n                    this._removeTriggerSelectorListener(tour.id)\n                }\n            })\n        })\n    }\n\n    private _showOrQueueTour(tour: ProductTour, reason: ProductTourRenderReason): void {\n        const delaySeconds = tour.conditions?.autoShowDelaySeconds || 0\n        if (delaySeconds > 0) {\n            if (!this.isTourPending(tour.id)) {\n                this.queueTourWithDelay(tour.id, delaySeconds, reason)\n            }\n        } else {\n            this.showTour(tour, { reason })\n        }\n    }\n\n    private _isTourEligible(tour: ProductTour): boolean {\n        if (!checkTourConditions(tour)) {\n            logger.info(`Tour ${tour.id} failed conditions check`)\n            return false\n        }\n\n        const completedKey = `${TOUR_COMPLETED_KEY_PREFIX}${tour.id}`\n        const dismissedKey = `${TOUR_DISMISSED_KEY_PREFIX}${tour.id}`\n\n        if (localStore._get(completedKey) || localStore._get(dismissedKey)) {\n            logger.info(`Tour ${tour.id} already completed or dismissed`)\n            return false\n        }\n\n        if (tour.internal_targeting_flag_key) {\n            const flagValue = this._instance.featureFlags?.getFeatureFlag(tour.internal_targeting_flag_key)\n            if (!flagValue) {\n                logger.info(`Tour ${tour.id} failed feature flag check: ${tour.internal_targeting_flag_key}`)\n                return false\n            }\n        }\n\n        return true\n    }\n\n    showTour(tour: ProductTour, options?: ShowTourOptions): void {\n        const renderReason: ProductTourRenderReason = options?.reason ?? 'auto'\n\n        this.cancelPendingTour(tour.id)\n\n        // Validate all step selectors before showing the tour\n        // Steps without selectors are modal steps and don't need validation\n        const selectorFailures: Array<{\n            stepIndex: number\n            stepId: string\n            selector: string\n            error: string\n            matchCount: number\n        }> = []\n\n        for (let i = 0; i < tour.steps.length; i++) {\n            const step = tour.steps[i]\n\n            // Skip validation for modal steps (no selector)\n            if (!step.selector) {\n                continue\n            }\n\n            const result = findElementBySelector(step.selector)\n\n            if (result.error === 'not_found' || result.error === 'not_visible') {\n                selectorFailures.push({\n                    stepIndex: i,\n                    stepId: step.id,\n                    selector: step.selector,\n                    error: result.error,\n                    matchCount: result.matchCount,\n                })\n            }\n        }\n\n        if (selectorFailures.length > 0) {\n            // Emit events for each failed selector for debugging/data purposes\n            for (const failure of selectorFailures) {\n                this._captureEvent('product tour step selector failed', {\n                    $product_tour_id: tour.id,\n                    $product_tour_step_id: failure.stepId,\n                    $product_tour_step_order: failure.stepIndex,\n                    $product_tour_step_selector: failure.selector,\n                    $product_tour_error: failure.error,\n                    $product_tour_matches_count: failure.matchCount,\n                    $product_tour_failure_phase: 'validation',\n                })\n            }\n\n            const failedSelectors = selectorFailures.map((f) => `Step ${f.stepIndex}: \"${f.selector}\" (${f.error})`)\n            logger.warn(\n                `Tour \"${tour.name}\" (${tour.id}): ${selectorFailures.length} selector(s) failed to match:\\n  - ${failedSelectors.join('\\n  - ')}${options?.enableStrictValidation === true ? '\\n\\nenableStrictValidation is true, not displaying tour.' : ''}`\n            )\n            if (options?.enableStrictValidation === true) return\n        }\n\n        this._activeTour = tour\n        this._currentStepIndex = 0\n\n        this._captureEvent('product tour shown', {\n            $product_tour_id: tour.id,\n            $product_tour_name: tour.name,\n            $product_tour_iteration: tour.current_iteration || 1,\n            $product_tour_render_reason: renderReason,\n        })\n\n        this._renderCurrentStep()\n    }\n\n    showTourById(tourId: string, reason?: ProductTourRenderReason): void {\n        logger.info(`showTourById(${tourId})`)\n        this._instance.productTours?.getProductTours((tours) => {\n            const tour = tours.find((t) => t.id === tourId)\n            if (tour) {\n                this.showTour(tour, { reason: reason ?? 'api' })\n            } else {\n                logger.warn('could not find tour', tourId)\n            }\n        })\n    }\n\n    previewTour(tour: ProductTour): void {\n        logger.info(`Previewing tour ${tour.id}`)\n\n        this._cleanup()\n\n        this._isPreviewMode = true\n        this._activeTour = tour\n        this._currentStepIndex = 0\n\n        this._renderCurrentStep()\n    }\n\n    nextStep = (): void => {\n        if (!this._activeTour) {\n            return\n        }\n\n        const currentStep = this._activeTour.steps[this._currentStepIndex]\n\n        this._captureEvent('product tour step completed', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: currentStep.id,\n            $product_tour_step_order: this._currentStepIndex,\n        })\n\n        if (this._currentStepIndex < this._activeTour.steps.length - 1) {\n            this._currentStepIndex++\n            this._renderCurrentStep()\n        } else {\n            this._completeTour()\n        }\n    }\n\n    previousStep = (): void => {\n        if (!this._activeTour || this._currentStepIndex === 0) {\n            return\n        }\n\n        this._currentStepIndex--\n        this._renderCurrentStep()\n    }\n\n    dismissTour = (reason: ProductTourDismissReason = 'user_clicked_skip'): void => {\n        if (!this._activeTour) {\n            return\n        }\n\n        const currentStep = this._activeTour.steps[this._currentStepIndex]\n\n        this._captureEvent('product tour dismissed', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: currentStep.id,\n            $product_tour_step_order: this._currentStepIndex,\n            $product_tour_dismiss_reason: reason,\n        })\n\n        if (!this._isPreviewMode) {\n            localStore._set(`${TOUR_DISMISSED_KEY_PREFIX}${this._activeTour.id}`, true)\n        }\n\n        window.dispatchEvent(\n            new CustomEvent('PHProductTourDismissed', { detail: { tourId: this._activeTour.id, reason } })\n        )\n\n        this._cleanup()\n    }\n\n    private _completeTour(): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        this._captureEvent('product tour completed', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_steps_count: this._activeTour.steps.length,\n        })\n\n        if (!this._isPreviewMode) {\n            localStore._set(`${TOUR_COMPLETED_KEY_PREFIX}${this._activeTour.id}`, true)\n\n            this._instance.capture('$set', {\n                $set: {\n                    [`$product_tour_completed/${this._activeTour.id}`]: true,\n                },\n            })\n        }\n\n        window.dispatchEvent(new CustomEvent('PHProductTourCompleted', { detail: { tourId: this._activeTour.id } }))\n\n        this._cleanup()\n    }\n\n    private _renderCurrentStep(retryCount: number = 0): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        const step = this._activeTour.steps[this._currentStepIndex]\n\n        // Survey step - render native survey step component\n        if (step.type === 'survey') {\n            if (step.survey) {\n                this._renderSurveyStep()\n            } else {\n                logger.warn('Unable to render survey step - survey data not found')\n            }\n\n            return\n        }\n\n        // Modal step (no selector) - render without a target element\n        if (step.type === 'modal') {\n            this._captureEvent('product tour step shown', {\n                $product_tour_id: this._activeTour.id,\n                $product_tour_step_id: step.id,\n                $product_tour_step_order: this._currentStepIndex,\n                $product_tour_step_type: 'modal',\n            })\n\n            this._renderTooltipWithPreact(null)\n            return\n        }\n\n        if (!step.selector) {\n            logger.warn('Unable to render element step - no selector defined.')\n            return\n        }\n\n        const result = findElementBySelector(step.selector)\n\n        const previousStep = this._currentStepIndex > 0 ? this._activeTour.steps[this._currentStepIndex - 1] : null\n        const shouldWaitForElement = previousStep?.progressionTrigger === 'click'\n\n        // 2s total timeout\n        const maxRetries = 20\n        const retryTimeout = 100\n\n        if (result.error === 'not_found' || result.error === 'not_visible') {\n            // if previous step was click-to-progress, give some time for the next element\n            if (shouldWaitForElement && retryCount < maxRetries) {\n                setTimeout(() => {\n                    this._renderCurrentStep(retryCount + 1)\n                }, retryTimeout)\n                return\n            }\n\n            const waitDurationMs = retryCount * retryTimeout\n\n            this._captureEvent('product tour step selector failed', {\n                $product_tour_id: this._activeTour.id,\n                $product_tour_step_id: step.id,\n                $product_tour_step_order: this._currentStepIndex,\n                $product_tour_step_selector: step.selector,\n                $product_tour_error: result.error,\n                $product_tour_matches_count: result.matchCount,\n                $product_tour_failure_phase: 'runtime',\n                $product_tour_waited_for_element: shouldWaitForElement,\n                $product_tour_wait_duration_ms: waitDurationMs,\n            })\n\n            logger.warn(\n                `Tour \"${this._activeTour.name}\" dismissed: element for step ${this._currentStepIndex} became unavailable (${result.error})` +\n                    (shouldWaitForElement ? ` after waiting ${waitDurationMs}ms` : '')\n            )\n            this.dismissTour('element_unavailable')\n            return\n        }\n\n        if (result.error === 'multiple_matches') {\n            this._captureEvent('product tour step selector failed', {\n                $product_tour_id: this._activeTour.id,\n                $product_tour_step_id: step.id,\n                $product_tour_step_order: this._currentStepIndex,\n                $product_tour_step_selector: step.selector,\n                $product_tour_error: result.error,\n                $product_tour_matches_count: result.matchCount,\n                $product_tour_failure_phase: 'runtime',\n            })\n            // Continue with first match for multiple_matches case\n        }\n\n        if (!result.element) {\n            return\n        }\n\n        const element = result.element\n        const metadata = getElementMetadata(element)\n\n        this._captureEvent('product tour step shown', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: step.id,\n            $product_tour_step_order: this._currentStepIndex,\n            $product_tour_step_selector: step.selector,\n            $product_tour_step_selector_found: true,\n            $product_tour_step_element_tag: metadata.tag,\n            $product_tour_step_element_id: metadata.id,\n            $product_tour_step_element_classes: metadata.classes,\n            $product_tour_step_element_text: metadata.text,\n        })\n\n        this._renderTooltipWithPreact(element)\n    }\n\n    private _renderTooltipWithPreact(\n        element: HTMLElement | null,\n        onSurveySubmit?: (response: string | number | null) => void,\n        onDismissOverride?: (reason: ProductTourDismissReason) => void\n    ): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        const step = this._activeTour.steps[this._currentStepIndex]\n        const { shadow } = retrieveTourShadow(this._activeTour)\n\n        render(\n            <ProductTourTooltip\n                tour={this._activeTour}\n                step={step}\n                stepIndex={this._currentStepIndex}\n                totalSteps={this._activeTour.steps.length}\n                targetElement={element}\n                onNext={this.nextStep}\n                onPrevious={this.previousStep}\n                onDismiss={onDismissOverride || this.dismissTour}\n                onSurveySubmit={onSurveySubmit}\n            />,\n            shadow\n        )\n    }\n\n    private _renderSurveyStep(): void {\n        if (!this._activeTour) {\n            return\n        }\n\n        const tourId = this._activeTour.id\n        const step = this._activeTour.steps[this._currentStepIndex]\n        const surveyId = step.linkedSurveyId\n        const questionId = step.linkedSurveyQuestionId\n        const questionText = step.survey?.questionText || ''\n\n        this._captureEvent('product tour step shown', {\n            $product_tour_id: this._activeTour.id,\n            $product_tour_step_id: step.id,\n            $product_tour_step_order: this._currentStepIndex,\n            $product_tour_step_type: 'survey',\n            $product_tour_linked_survey_id: surveyId,\n        })\n\n        this._captureEvent(SurveyEventName.SHOWN, {\n            [SurveyEventProperties.SURVEY_ID]: surveyId,\n            [SurveyEventProperties.PRODUCT_TOUR_ID]: tourId,\n            sessionRecordingUrl: this._instance.get_session_replay_url?.(),\n        })\n\n        const handleSubmit = (response: string | number | null) => {\n            const responseKey = questionId ? `$survey_response_${questionId}` : '$survey_response'\n            this._captureEvent(SurveyEventName.SENT, {\n                [SurveyEventProperties.SURVEY_ID]: surveyId,\n                [SurveyEventProperties.PRODUCT_TOUR_ID]: tourId,\n                [SurveyEventProperties.SURVEY_QUESTIONS]: [\n                    {\n                        id: questionId,\n                        question: questionText,\n                        response: response,\n                    },\n                ],\n                [SurveyEventProperties.SURVEY_COMPLETED]: true,\n                sessionRecordingUrl: this._instance.get_session_replay_url?.(),\n                ...(!isNull(response) && { [responseKey]: response }),\n            })\n\n            logger.info(`Survey ${surveyId} completed`, !isNull(response) ? `with response: ${response}` : '(skipped)')\n            this.nextStep()\n        }\n\n        const handleDismiss = (reason: ProductTourDismissReason) => {\n            this._captureEvent(SurveyEventName.DISMISSED, {\n                [SurveyEventProperties.SURVEY_ID]: surveyId,\n                [SurveyEventProperties.PRODUCT_TOUR_ID]: tourId,\n                [SurveyEventProperties.SURVEY_QUESTIONS]: [\n                    {\n                        id: questionId,\n                        question: questionText,\n                        response: null,\n                    },\n                ],\n                [SurveyEventProperties.SURVEY_PARTIALLY_COMPLETED]: false,\n                sessionRecordingUrl: this._instance.get_session_replay_url?.(),\n            })\n\n            logger.info(`Survey ${surveyId} dismissed`)\n            this.dismissTour(reason)\n        }\n\n        this._renderTooltipWithPreact(null, handleSubmit, handleDismiss)\n\n        logger.info(`Rendered survey step for tour step ${this._currentStepIndex}`)\n    }\n\n    private _cleanup(): void {\n        if (this._activeTour) {\n            removeTourFromDom(this._activeTour.id)\n        }\n\n        this._activeTour = null\n        this._currentStepIndex = 0\n        this._isPreviewMode = false\n    }\n\n    private _manageTriggerSelectorListener(tour: ProductTour, selector: string): void {\n        const currentElement = document.querySelector(selector)\n        const existingListenerData = this._triggerSelectorListeners.get(tour.id)\n\n        if (!currentElement) {\n            if (existingListenerData) {\n                this._removeTriggerSelectorListener(tour.id)\n            }\n            return\n        }\n\n        if (existingListenerData) {\n            if (currentElement !== existingListenerData.element) {\n                logger.info(`Trigger element changed for tour ${tour.id}. Re-attaching listener.`)\n                this._removeTriggerSelectorListener(tour.id)\n            } else {\n                return\n            }\n        }\n\n        if (!currentElement.hasAttribute(TRIGGER_LISTENER_ATTRIBUTE)) {\n            const listener = (event: Event) => {\n                event.stopPropagation()\n\n                if (this._activeTour) {\n                    logger.info(`Tour ${tour.id} trigger clicked but another tour is active`)\n                    return\n                }\n\n                // manual triggers only check launch status + URL, no other conditions\n                if (!checkTourConditions(tour)) {\n                    logger.warn(`Tour ${tour.id} trigger clicked but failed conditions check`)\n                    return\n                }\n\n                logger.info(`Tour ${tour.id} triggered by click on ${selector}`)\n                this.showTour(tour, { reason: 'trigger' })\n            }\n\n            addEventListener(currentElement, 'click', listener)\n            currentElement.setAttribute(TRIGGER_LISTENER_ATTRIBUTE, tour.id)\n            this._triggerSelectorListeners.set(tour.id, { element: currentElement, listener, tour })\n            logger.info(`Attached trigger listener for tour ${tour.id} on ${selector}`)\n        }\n    }\n\n    private _removeTriggerSelectorListener(tourId: string): void {\n        const existing = this._triggerSelectorListeners.get(tourId)\n        if (existing) {\n            existing.element.removeEventListener('click', existing.listener)\n            existing.element.removeAttribute(TRIGGER_LISTENER_ATTRIBUTE)\n            this._triggerSelectorListeners.delete(tourId)\n            logger.info(`Removed trigger listener for tour ${tourId}`)\n        }\n    }\n\n    private _removeAllTriggerListeners(): void {\n        this._triggerSelectorListeners.forEach((_, tourId) => {\n            this._removeTriggerSelectorListener(tourId)\n        })\n    }\n\n    private _captureEvent(eventName: string, properties: Record<string, any>): void {\n        if (this._isPreviewMode) {\n            return\n        }\n        this._instance.capture(eventName, properties)\n    }\n\n    // Public API methods delegated from PostHogProductTours\n    getActiveProductTours(callback: ProductTourCallback): void {\n        this._instance.productTours?.getProductTours((tours, context) => {\n            if (!context?.isLoaded) {\n                callback([], context)\n                return\n            }\n\n            const activeTours = tours.filter((tour) => this._isTourEligible(tour))\n            callback(activeTours, context)\n        })\n    }\n\n    resetTour(tourId: string): void {\n        localStore._remove(`${TOUR_COMPLETED_KEY_PREFIX}${tourId}`)\n        localStore._remove(`${TOUR_DISMISSED_KEY_PREFIX}${tourId}`)\n    }\n\n    resetAllTours(): void {\n        const storage = window?.localStorage\n        if (!storage) {\n            return\n        }\n        const keysToRemove: string[] = []\n        for (let i = 0; i < storage.length; i++) {\n            const key = storage.key(i)\n            if (key?.startsWith(TOUR_COMPLETED_KEY_PREFIX) || key?.startsWith(TOUR_DISMISSED_KEY_PREFIX)) {\n                keysToRemove.push(key)\n            }\n        }\n        keysToRemove.forEach((key) => localStore._remove(key))\n    }\n\n    cancelPendingTour(tourId: string): void {\n        const timeout = this._pendingTourTimeouts.get(tourId)\n        if (timeout) {\n            clearTimeout(timeout)\n            this._pendingTourTimeouts.delete(tourId)\n            logger.info(`Cancelled pending tour: ${tourId}`)\n        }\n    }\n\n    private _cancelAllPendingTours(): void {\n        this._pendingTourTimeouts.forEach((timeout) => clearTimeout(timeout))\n        this._pendingTourTimeouts.clear()\n    }\n\n    isTourPending(tourId: string): boolean {\n        return this._pendingTourTimeouts.has(tourId)\n    }\n\n    queueTourWithDelay(tourId: string, delaySeconds: number, reason?: ProductTourRenderReason): void {\n        logger.info(`Queueing tour ${tourId} with ${delaySeconds}s delay`)\n\n        const timeoutId = setTimeout(() => {\n            this._pendingTourTimeouts.delete(tourId)\n            logger.info(`Delay elapsed for tour ${tourId}, showing now`)\n            this.showTourById(tourId, reason)\n        }, delaySeconds * 1000)\n\n        this._pendingTourTimeouts.set(tourId, timeoutId)\n    }\n}\n"]}