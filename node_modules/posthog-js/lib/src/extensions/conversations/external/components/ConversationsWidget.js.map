{"version":3,"file":"ConversationsWidget.js","sourceRoot":"","sources":["../../../../../../src/extensions/conversations/external/components/ConversationsWidget.tsx"],"names":[],"mappings":"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","sourcesContent":["// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, Component, Fragment } from 'preact'\nimport {\n    ConversationsRemoteConfig,\n    Message,\n    ConversationsWidgetState,\n    UserProvidedTraits,\n} from '../../../../posthog-conversations-types'\nimport { createLogger } from '../../../../utils/logger'\nimport { getStyles } from './styles'\nimport { OpenChatButton } from './OpenChatButton'\nimport { SendMessageButton } from './SendMessageButton'\nimport { CloseChatButton } from './CloseChatButton'\n\nconst logger = createLogger('[ConversationsWidget]')\n\ninterface WidgetProps {\n    config: ConversationsRemoteConfig\n    initialState?: ConversationsWidgetState\n    initialUserTraits?: UserProvidedTraits | null\n    onSendMessage: (message: string) => Promise<void>\n    onStateChange?: (state: ConversationsWidgetState) => void\n    onIdentify?: (traits: UserProvidedTraits) => void\n}\n\ninterface WidgetState {\n    state: ConversationsWidgetState\n    messages: Message[]\n    inputValue: string\n    isLoading: boolean\n    error: string | null\n    showIdentificationForm: boolean\n    formName: string\n    formEmail: string\n    formEmailError: string | null\n    userTraits: UserProvidedTraits | null\n    unreadCount: number\n}\n\nexport class ConversationsWidget extends Component<WidgetProps, WidgetState> {\n    private _messagesEndRef: HTMLDivElement | null = null\n    private _inputRef: HTMLTextAreaElement | null = null\n\n    constructor(props: WidgetProps) {\n        super(props)\n\n        // Determine if we need to show the identification form\n        const userTraits = props.initialUserTraits || null\n        const needsIdentification = this._needsIdentification(props.config, userTraits)\n\n        this.state = {\n            state: props.initialState || 'closed',\n            messages: [],\n            inputValue: '',\n            isLoading: false,\n            error: null,\n            showIdentificationForm: needsIdentification,\n            formName: userTraits?.name || '',\n            formEmail: userTraits?.email || '',\n            formEmailError: null,\n            userTraits,\n            unreadCount: 0,\n        }\n    }\n\n    /**\n     * Check if we need to show the identification form\n     */\n    private _needsIdentification(config: ConversationsRemoteConfig, traits: UserProvidedTraits | null): boolean {\n        // If requireEmail is not set, no identification needed\n        if (!config.requireEmail) {\n            //return false\n        }\n\n        // If we already have an email, no form needed\n        if (traits?.email) {\n            return false\n        }\n\n        return true\n    }\n\n    componentDidMount() {\n        // Add greeting message if no messages exist\n        if (this.state.messages.length === 0 && this.props.config.greetingText) {\n            this._addGreetingMessage()\n        }\n    }\n\n    componentDidUpdate(_prevProps: WidgetProps, prevState: WidgetState) {\n        // Scroll to bottom when messages change\n        if (this.state.messages.length !== prevState.messages.length) {\n            this._scrollToBottom()\n        }\n\n        // Notify parent of state changes\n        if (this.state.state !== prevState.state && this.props.onStateChange) {\n            this.props.onStateChange(this.state.state)\n        }\n\n        // Focus input and scroll to bottom when opening\n        if (this.state.state === 'open' && prevState.state !== 'open') {\n            this._focusInput()\n            this._scrollToBottom()\n        }\n    }\n\n    private _addGreetingMessage() {\n        const greetingMessage: Message = {\n            id: 'greeting',\n            content: this.props.config.greetingText || 'Hi! How can we help?',\n            author_type: 'AI',\n            author_name: 'Support',\n            created_at: new Date().toISOString(),\n            is_private: false,\n        }\n        this.setState({ messages: [greetingMessage] })\n    }\n\n    private _scrollToBottom() {\n        if (this._messagesEndRef) {\n            this._messagesEndRef.scrollIntoView({ behavior: 'smooth' })\n        }\n    }\n\n    private _focusInput() {\n        if (this._inputRef) {\n            this._inputRef.focus()\n        }\n    }\n\n    private _handleToggleOpen = () => {\n        this.setState((prevState) => ({\n            state: prevState.state === 'open' ? 'closed' : 'open',\n        }))\n    }\n\n    private _handleClose = () => {\n        this.setState({ state: 'closed' })\n    }\n\n    private _handleInputChange = (e: Event) => {\n        const target = e.target as HTMLTextAreaElement\n        this.setState({ inputValue: target.value })\n    }\n\n    private _handleKeyPress = (e: KeyboardEvent) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault()\n            this._handleSendMessage()\n        }\n    }\n\n    // Identification form handlers\n    private _handleFormNameChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({ formName: target.value })\n    }\n\n    private _handleFormEmailChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({ formEmail: target.value, formEmailError: null })\n    }\n\n    private _validateEmail(email: string): boolean {\n        // Basic email validation\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n        return emailRegex.test(email)\n    }\n\n    private _handleFormSubmit = (e: Event) => {\n        e.preventDefault()\n\n        const { formEmail, formName } = this.state\n        const { config, onIdentify } = this.props\n\n        // Validate email if required\n        if (config.requireEmail && !formEmail.trim()) {\n            this.setState({ formEmailError: 'Email is required' })\n            return\n        }\n\n        if (formEmail.trim() && !this._validateEmail(formEmail.trim())) {\n            this.setState({ formEmailError: 'Please enter a valid email address' })\n            return\n        }\n\n        // Create traits object\n        const traits: UserProvidedTraits = {}\n        if (formName.trim()) {\n            traits.name = formName.trim()\n        }\n        if (formEmail.trim()) {\n            traits.email = formEmail.trim()\n        }\n\n        // Update state and notify parent\n        this.setState({\n            userTraits: traits,\n            showIdentificationForm: false,\n        })\n\n        if (onIdentify) {\n            onIdentify(traits)\n        }\n    }\n\n    private _handleSendMessage = async () => {\n        const { inputValue } = this.state\n        const trimmedMessage = inputValue.trim()\n\n        if (!trimmedMessage) {\n            return\n        }\n\n        // Add user message to UI immediately\n        const userMessage: Message = {\n            id: `temp-${Date.now()}`,\n            content: trimmedMessage,\n            author_type: 'customer',\n            author_name: 'You',\n            created_at: new Date().toISOString(),\n            is_private: false,\n        }\n\n        this.setState({\n            messages: [...this.state.messages, userMessage],\n            inputValue: '',\n            isLoading: true,\n            error: null,\n        })\n\n        try {\n            await this.props.onSendMessage(trimmedMessage)\n            // Success - message will be updated via addMessage()\n            this.setState({ isLoading: false })\n        } catch (error) {\n            logger.error('Failed to send message', error)\n            this.setState({\n                isLoading: false,\n                error: error instanceof Error ? error.message : 'Failed to send message',\n            })\n\n            // Remove the temporary message on error\n            this.setState((prevState) => ({\n                messages: prevState.messages.filter((m) => m.id !== userMessage.id),\n            }))\n        }\n    }\n\n    private _formatTime(isoString: string): string {\n        const date = new Date(isoString)\n        const now = new Date()\n        const diffMs = now.getTime() - date.getTime()\n        const diffMins = Math.floor(diffMs / 60000)\n\n        if (diffMins < 1) {\n            return 'Just now'\n        } else if (diffMins < 60) {\n            return `${diffMins}m ago`\n        } else if (diffMins < 1440) {\n            return `${Math.floor(diffMins / 60)}h ago`\n        } else {\n            return date.toLocaleDateString()\n        }\n    }\n\n    /**\n     * Public method to add messages from outside\n     */\n    addMessages(messages: Message[]) {\n        this.setState((prevState) => {\n            // Filter out duplicates\n            const existingIds = new Set(prevState.messages.map((m) => m.id))\n            const newMessages = messages.filter((m) => !existingIds.has(m.id))\n\n            if (newMessages.length > 0) {\n                return {\n                    messages: [...prevState.messages, ...newMessages],\n                }\n            }\n            return null\n        })\n    }\n\n    /**\n     * Public method to show the widget\n     */\n    show() {\n        this.setState({ state: 'open' })\n    }\n\n    /**\n     * Public method to hide the widget\n     */\n    hide() {\n        this.setState({ state: 'closed' })\n    }\n\n    /**\n     * Public method to close the widget completely\n     */\n    close() {\n        this.setState({ state: 'closed' })\n    }\n\n    /**\n     * Get user traits (either provided via form or from props)\n     */\n    getUserTraits(): UserProvidedTraits | null {\n        return this.state.userTraits\n    }\n\n    /**\n     * Set the unread message count (called by manager)\n     */\n    setUnreadCount(count: number): void {\n        this.setState({ unreadCount: count })\n    }\n\n    private _renderIdentificationForm(styles: ReturnType<typeof getStyles>) {\n        const { config } = this.props\n        const { formName, formEmail, formEmailError } = this.state\n\n        const title = config.identificationFormTitle || 'Before we start...'\n        const description =\n            config.identificationFormDescription || 'Please provide your details so we can help you better.'\n        const showNameField = config.collectName !== false // Show by default unless explicitly disabled\n\n        return (\n            <div style={styles.identificationForm}>\n                <div style={styles.formTitle}>{title}</div>\n                <div style={styles.formDescription}>{description}</div>\n\n                <form onSubmit={this._handleFormSubmit}>\n                    {showNameField && (\n                        <div style={styles.formField}>\n                            <label style={styles.formLabel}>\n                                Name <span style={styles.formOptional}>(optional)</span>\n                            </label>\n                            <input\n                                type=\"text\"\n                                style={styles.formInput}\n                                value={formName}\n                                onInput={this._handleFormNameChange}\n                                placeholder=\"Your name\"\n                                autoComplete=\"name\"\n                            />\n                        </div>\n                    )}\n\n                    <div style={styles.formField}>\n                        <label style={styles.formLabel}>\n                            Email {!config.requireEmail && <span style={styles.formOptional}>(optional)</span>}\n                        </label>\n                        <input\n                            type=\"email\"\n                            style={{\n                                ...styles.formInput,\n                                ...(formEmailError ? styles.formInputError : {}),\n                            }}\n                            value={formEmail}\n                            onInput={this._handleFormEmailChange}\n                            placeholder=\"you@example.com\"\n                            autoComplete=\"email\"\n                        />\n                        {formEmailError && <div style={styles.formError}>{formEmailError}</div>}\n                    </div>\n\n                    <button\n                        type=\"submit\"\n                        style={styles.formSubmitButton}\n                        onMouseEnter={(e) => {\n                            e.currentTarget.style.opacity = '0.9'\n                        }}\n                        onMouseLeave={(e) => {\n                            e.currentTarget.style.opacity = '1'\n                        }}\n                    >\n                        Start Chat\n                    </button>\n                </form>\n            </div>\n        )\n    }\n\n    private _renderMessage(message: Message, styles: ReturnType<typeof getStyles>) {\n        const isCustomer = message.author_type === 'customer'\n        const messageStyle = {\n            ...styles.message,\n            ...(isCustomer ? styles.messageCustomer : styles.messageAgent),\n        }\n        const contentStyle = {\n            ...styles.messageContent,\n            ...(isCustomer ? styles.messageContentCustomer : styles.messageContentAgent),\n        }\n\n        return (\n            <div key={message.id} style={messageStyle}>\n                {!isCustomer && message.author_name && <div style={styles.messageAuthor}>{message.author_name}</div>}\n                <div style={contentStyle}>{message.content}</div>\n                <div style={styles.messageTime}>{this._formatTime(message.created_at)}</div>\n            </div>\n        )\n    }\n\n    render() {\n        const { config } = this.props\n        const { state, messages, inputValue, isLoading, error, showIdentificationForm } = this.state\n        const primaryColor = config.color || '#5375ff'\n        const placeholderText = config.placeholderText || 'Type your message...'\n        const styles = getStyles(primaryColor)\n\n        // Button only (closed state)\n        if (state === 'closed') {\n            return (\n                <OpenChatButton\n                    primaryColor={primaryColor}\n                    handleToggleOpen={this._handleToggleOpen}\n                    unreadCount={this.state.unreadCount}\n                />\n            )\n        }\n\n        // Open state\n        const windowStyle = {\n            ...styles.window,\n            ...styles.windowOpen,\n        }\n\n        return (\n            <div style={styles.widget}>\n                <div style={windowStyle}>\n                    {/* Header */}\n                    <div style={styles.header}>\n                        <div style={styles.headerTitle}>\n                            <span>Support Chat</span>\n                        </div>\n                        <div style={styles.headerActions}>\n                            <CloseChatButton primaryColor={primaryColor} handleClose={this._handleClose} />\n                        </div>\n                    </div>\n\n                    {/* Show identification form if needed, otherwise show chat */}\n                    {showIdentificationForm ? (\n                        this._renderIdentificationForm(styles)\n                    ) : (\n                        <>\n                            <div style={styles.messages}>\n                                {messages.map((message) => this._renderMessage(message, styles))}\n                                {isLoading && (\n                                    <div style={{ ...styles.message, ...styles.messageAgent }}>\n                                        <div\n                                            style={{\n                                                ...styles.messageContent,\n                                                ...styles.messageContentAgent,\n                                                ...styles.typing,\n                                            }}\n                                        >\n                                            <span style={styles.typingDot}></span>\n                                            <span style={{ ...styles.typingDot, animationDelay: '0.2s' }}></span>\n                                            <span style={{ ...styles.typingDot, animationDelay: '0.4s' }}></span>\n                                        </div>\n                                    </div>\n                                )}\n                                <div ref={(el) => (this._messagesEndRef = el)} />\n                            </div>\n\n                            {/* Error message */}\n                            {error && <div style={styles.error}>{error}</div>}\n\n                            {/* Input */}\n                            <div style={styles.inputContainer}>\n                                <textarea\n                                    ref={(el) => (this._inputRef = el)}\n                                    style={styles.input}\n                                    placeholder={placeholderText}\n                                    value={inputValue}\n                                    onInput={this._handleInputChange}\n                                    onKeyPress={this._handleKeyPress}\n                                    rows={1}\n                                    disabled={isLoading}\n                                />\n                                <SendMessageButton\n                                    primaryColor={primaryColor}\n                                    inputValue={inputValue}\n                                    isLoading={isLoading}\n                                    handleSendMessage={this._handleSendMessage}\n                                />\n                            </div>\n                        </>\n                    )}\n                </div>\n            </div>\n        )\n    }\n}\n"]}