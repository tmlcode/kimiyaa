!function(){"use strict";function e(e,t,i,n,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,r)}function t(t){return function(){var i=this,n=arguments;return new Promise((function(r,o){var s=t.apply(i,n);function a(t){e(s,r,o,a,l,"next",t)}function l(t){e(s,r,o,a,l,"throw",t)}a(void 0)}))}}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i.apply(null,arguments)}var n,r,o,s,a,l,u,d={},h=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,f=Array.isArray;function p(e,t){for(var i in t)e[i]=t[i];return e}function v(e){var t=e.parentNode;t&&t.removeChild(e)}function g(e,t,i,n,s){var a={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==s?++o:s,__i:-1,__u:0};return null==s&&null!=r.vnode&&r.vnode(a),a}function m(e){return e.children}function y(e,t){this.props=e,this.context=t}function w(e,t){if(null==t)return e.__?w(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?w(e):null}function x(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return x(e)}}function b(e){(!e.__d&&(e.__d=!0)&&s.push(e)&&!_.__r++||a!==r.debounceRendering)&&((a=r.debounceRendering)||l)(_)}function _(){var e,t,i,n,o,a,l,d,h;for(s.sort(u);e=s.shift();)e.__d&&(t=s.length,n=void 0,a=(o=(i=e).__v).__e,d=[],h=[],(l=i.__P)&&((n=p({},o)).__v=o.__v+1,r.vnode&&r.vnode(n),F(l,n,o,i.__n,void 0!==l.ownerSVGElement,32&o.__u?[a]:null,d,null==a?w(o):a,!!(32&o.__u),h),n.__.__k[n.__i]=n,P(d,n,h),n.__e!=a&&x(n)),s.length>t&&s.sort(u));_.__r=0}function k(e,t,i,n,r,o,s,a,l,u,c){var f,p,v,g,m,y=n&&n.__k||h,w=t.length;for(i.__d=l,C(i,t,y),l=i.__d,f=0;f<w;f++)null!=(v=i.__k[f])&&"boolean"!=typeof v&&"function"!=typeof v&&(p=-1===v.__i?d:y[v.__i]||d,v.__i=f,F(e,v,p,r,o,s,a,l,u,c),g=v.__e,v.ref&&p.ref!=v.ref&&(p.ref&&z(p.ref,null,v),c.push(v.ref,v.__c||g,v)),null==m&&null!=g&&(m=g),65536&v.__u||p.__k===v.__k?l=I(v,l,e):"function"==typeof v.type&&void 0!==v.__d?l=v.__d:g&&(l=g.nextSibling),v.__d=void 0,v.__u&=-196609);i.__d=l,i.__e=m}function C(e,t,i){var n,r,o,s,a,l=t.length,u=i.length,d=u,h=0;for(e.__k=[],n=0;n<l;n++)null!=(r=e.__k[n]=null==(r=t[n])||"boolean"==typeof r||"function"==typeof r?null:"string"==typeof r||"number"==typeof r||"bigint"==typeof r||r.constructor==String?g(null,r,null,null,r):f(r)?g(m,{children:r},null,null,null):void 0===r.constructor&&r.__b>0?g(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):r)?(r.__=e,r.__b=e.__b+1,a=S(r,i,s=n+h,d),r.__i=a,o=null,-1!==a&&(d--,(o=i[a])&&(o.__u|=131072)),null==o||null===o.__v?(-1==a&&h--,"function"!=typeof r.type&&(r.__u|=65536)):a!==s&&(a===s+1?h++:a>s?d>l-s?h+=a-s:h--:h=a<s&&a==s-1?a-s:0,a!==n+h&&(r.__u|=65536))):(o=i[n])&&null==o.key&&o.__e&&(o.__e==e.__d&&(e.__d=w(o)),A(o,o,!1),i[n]=null,d--);if(d)for(n=0;n<u;n++)null!=(o=i[n])&&0==(131072&o.__u)&&(o.__e==e.__d&&(e.__d=w(o)),A(o,o))}function I(e,t,i){var n,r;if("function"==typeof e.type){for(n=e.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=e,t=I(n[r],t,i));return t}return e.__e!=t&&(i.insertBefore(e.__e,t||null),t=e.__e),t&&t.nextSibling}function S(e,t,i,n){var r=e.key,o=e.type,s=i-1,a=i+1,l=t[i];if(null===l||l&&r==l.key&&o===l.type)return i;if(n>(null!=l&&0==(131072&l.__u)?1:0))for(;s>=0||a<t.length;){if(s>=0){if((l=t[s])&&0==(131072&l.__u)&&r==l.key&&o===l.type)return s;s--}if(a<t.length){if((l=t[a])&&0==(131072&l.__u)&&r==l.key&&o===l.type)return a;a++}}return-1}function E(e,t,i){"-"===t[0]?e.setProperty(t,null==i?"":i):e[t]=null==i?"":"number"!=typeof i||c.test(t)?i:i+"px"}function M(e,t,i,n,r){var o;e:if("style"===t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||E(e.style,t,"");if(i)for(t in i)n&&i[t]===n[t]||E(e.style,t,i[t])}else if("o"===t[0]&&"n"===t[1])o=t!==(t=t.replace(/(PointerCapture)$|Capture$/,"$1")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=i,i?n?i.u=n.u:(i.u=Date.now(),e.addEventListener(t,o?D:T,o)):e.removeEventListener(t,o?D:T,o);else{if(r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==t&&"height"!==t&&"href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&"rowSpan"!==t&&"colSpan"!==t&&"role"!==t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null==i||!1===i&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,i))}}function T(e){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(r.event?r.event(e):e)}function D(e){return this.l[e.type+!0](r.event?r.event(e):e)}function F(e,t,i,n,o,s,a,l,u,d){var h,c,v,g,w,x,b,_,C,I,S,$,E,M,T,D=t.type;if(void 0!==t.constructor)return null;128&i.__u&&(u=!!(32&i.__u),s=[l=t.__e=i.__e]),(h=r.__b)&&h(t);e:if("function"==typeof D)try{if(_=t.props,C=(h=D.contextType)&&n[h.__c],I=h?C?C.props.value:h.__:n,i.__c?b=(c=t.__c=i.__c).__=c.__E:("prototype"in D&&D.prototype.render?t.__c=c=new D(_,I):(t.__c=c=new y(_,I),c.constructor=D,c.render=W),C&&C.sub(c),c.props=_,c.state||(c.state={}),c.context=I,c.__n=n,v=c.__d=!0,c.__h=[],c._sb=[]),null==c.__s&&(c.__s=c.state),null!=D.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=p({},c.__s)),p(c.__s,D.getDerivedStateFromProps(_,c.__s))),g=c.props,w=c.state,c.__v=t,v)null==D.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(null==D.getDerivedStateFromProps&&_!==g&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(_,I),!c.__e&&(null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(_,c.__s,I)||t.__v===i.__v)){for(t.__v!==i.__v&&(c.props=_,c.state=c.__s,c.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.forEach((function(e){e&&(e.__=t)})),S=0;S<c._sb.length;S++)c.__h.push(c._sb[S]);c._sb=[],c.__h.length&&a.push(c);break e}null!=c.componentWillUpdate&&c.componentWillUpdate(_,c.__s,I),null!=c.componentDidUpdate&&c.__h.push((function(){c.componentDidUpdate(g,w,x)}))}if(c.context=I,c.props=_,c.__P=e,c.__e=!1,$=r.__r,E=0,"prototype"in D&&D.prototype.render){for(c.state=c.__s,c.__d=!1,$&&$(t),h=c.render(c.props,c.state,c.context),M=0;M<c._sb.length;M++)c.__h.push(c._sb[M]);c._sb=[]}else do{c.__d=!1,$&&$(t),h=c.render(c.props,c.state,c.context),c.state=c.__s}while(c.__d&&++E<25);c.state=c.__s,null!=c.getChildContext&&(n=p(p({},n),c.getChildContext())),v||null==c.getSnapshotBeforeUpdate||(x=c.getSnapshotBeforeUpdate(g,w)),k(e,f(T=null!=h&&h.type===m&&null==h.key?h.props.children:h)?T:[T],t,i,n,o,s,a,l,u,d),c.base=t.__e,t.__u&=-161,c.__h.length&&a.push(c),b&&(c.__E=c.__=null)}catch(e){t.__v=null,u||null!=s?(t.__e=l,t.__u|=u?160:32,s[s.indexOf(l)]=null):(t.__e=i.__e,t.__k=i.__k),r.__e(e,t,i)}else null==s&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=L(i.__e,t,i,n,o,s,a,u,d);(h=r.diffed)&&h(t)}function P(e,t,i){t.__d=void 0;for(var n=0;n<i.length;n++)z(i[n],i[++n],i[++n]);r.__c&&r.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){r.__e(e,t.__v)}}))}function L(e,t,i,r,o,s,a,l,u){var h,c,p,g,m,y,x,b=i.props,_=t.props,C=t.type;if("svg"===C&&(o=!0),null!=s)for(h=0;h<s.length;h++)if((m=s[h])&&"setAttribute"in m==!!C&&(C?m.localName===C:3===m.nodeType)){e=m,s[h]=null;break}if(null==e){if(null===C)return document.createTextNode(_);e=o?document.createElementNS("http://www.w3.org/2000/svg",C):document.createElement(C,_.is&&_),s=null,l=!1}if(null===C)b===_||l&&e.data===_||(e.data=_);else{if(s=s&&n.call(e.childNodes),b=i.props||d,!l&&null!=s)for(b={},h=0;h<e.attributes.length;h++)b[(m=e.attributes[h]).name]=m.value;for(h in b)m=b[h],"children"==h||("dangerouslySetInnerHTML"==h?p=m:"key"===h||h in _||M(e,h,null,m,o));for(h in _)m=_[h],"children"==h?g=m:"dangerouslySetInnerHTML"==h?c=m:"value"==h?y=m:"checked"==h?x=m:"key"===h||l&&"function"!=typeof m||b[h]===m||M(e,h,m,b[h],o);if(c)l||p&&(c.__html===p.__html||c.__html===e.innerHTML)||(e.innerHTML=c.__html),t.__k=[];else if(p&&(e.innerHTML=""),k(e,f(g)?g:[g],t,i,r,o&&"foreignObject"!==C,s,a,s?s[0]:i.__k&&w(i,0),l,u),null!=s)for(h=s.length;h--;)null!=s[h]&&v(s[h]);l||(h="value",void 0!==y&&(y!==e[h]||"progress"===C&&!y||"option"===C&&y!==b[h])&&M(e,h,y,b[h],!1),h="checked",void 0!==x&&x!==e[h]&&M(e,h,x,b[h],!1))}return e}function z(e,t,i){try{"function"==typeof e?e(t):e.current=t}catch(e){r.__e(e,i)}}function A(e,t,i){var n,o;if(r.unmount&&r.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||z(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){r.__e(e,t)}n.base=n.__P=null,e.__c=void 0}if(n=e.__k)for(o=0;o<n.length;o++)n[o]&&A(n[o],t,i||"function"!=typeof e.type);i||null==e.__e||v(e.__e),e.__=e.__e=e.__d=void 0}function W(e,t,i){return this.constructor(e,i)}function U(e,t,i){var o,s,a;r.__&&r.__(e,t),o=!1?null:t.__k,s=[],a=[],F(t,e=t.__k=function(e,t,i){var r,o,s,a={};for(s in t)"key"==s?r=t[s]:"ref"==s?o=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?n.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return g(e,a,r,o,null)}(m,null,[e]),o||d,d,void 0!==t.ownerSVGElement,o?null:t.firstChild?n.call(t.childNodes):null,s,o?o.__e:t.firstChild,false,a),P(s,e,a)}n=h.slice,r={__e:function(e,t,i,n){for(var r,o,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,n||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},o=0,y.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=p({},this.state),"function"==typeof e&&(e=e(p({},i),this.props)),e&&p(i,e),null!=e&&this.__v&&(t&&this._sb.push(t),b(this))},y.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),b(this))},y.prototype.render=m,s=[],l="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,u=function(e,t){return e.__v.__b-t.__v.__b},_.__r=0;var N=Array.isArray,R=Object.prototype,B=R.hasOwnProperty,O=R.toString,H=N||function(e){return"[object Array]"===O.call(e)},j=e=>void 0===e,V=e=>"[object Number]"==O.call(e),Y="undefined"!=typeof window?window:void 0,G="undefined"!=typeof globalThis?globalThis:Y;"undefined"==typeof self&&(G.self=G),"undefined"==typeof File&&(G.File=function(){});var q=Array.prototype.forEach,K=null==G?void 0:G.navigator,X=null==G?void 0:G.document;null==G||G.location,null==G||G.fetch,null!=G&&G.XMLHttpRequest&&"withCredentials"in new G.XMLHttpRequest&&G.XMLHttpRequest,null==G||G.AbortController,null==K||K.userAgent;var Z=null!=Y?Y:{},J=function(e,t){var{debugEnabled:i}=void 0===t?{}:t,n={i:function(t){if(Y&&(Z.POSTHOG_DEBUG||i)&&!j(Y.console)&&Y.console){for(var n=("__rrweb_original__"in Y.console[t]?Y.console[t].__rrweb_original__:Y.console[t]),r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];n(e,...o)}},info:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("log",...t)},warn:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("warn",...t)},error:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("error",...t)},critical:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];console.error(e,...i)},uninitializedWarning:e=>{n.error("You must initialize PostHog before calling "+e)},createLogger:(t,i)=>J(e+" "+t,i)};return n},Q=J("[PostHog.js]").createLogger;Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return V(e)&&isFinite(e)&&Math.floor(e)===e});var ee="0123456789abcdef";class te{constructor(e){if(this.bytes=e,16!==e.length)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,i,n){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(i)||!Number.isInteger(n)||e<0||t<0||i<0||n<0||e>0xffffffffffff||t>4095||i>1073741823||n>4294967295)throw new RangeError("invalid field value");var r=new Uint8Array(16);return r[0]=e/Math.pow(2,40),r[1]=e/Math.pow(2,32),r[2]=e/Math.pow(2,24),r[3]=e/Math.pow(2,16),r[4]=e/Math.pow(2,8),r[5]=e,r[6]=112|t>>>8,r[7]=t,r[8]=128|i>>>24,r[9]=i>>>16,r[10]=i>>>8,r[11]=i,r[12]=n>>>24,r[13]=n>>>16,r[14]=n>>>8,r[15]=n,new te(r)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+ee.charAt(this.bytes[t]>>>4)+ee.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new te(this.bytes.slice(0))}equals(e){return 0===this.compareTo(e)}compareTo(e){for(var t=0;t<16;t++){var i=this.bytes[t]-e.bytes[t];if(0!==i)return Math.sign(i)}return 0}}class ie{constructor(){this.o=0,this.h=0,this.p=new oe}generate(){var e=this.generateOrAbort();if(j(e)){this.o=0;var t=this.generateOrAbort();if(j(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.o)this.o=e,this.v();else{if(!(e+1e4>this.o))return;this.h++,this.h>4398046511103&&(this.o++,this.v())}return te.fromFieldsV7(this.o,Math.trunc(this.h/Math.pow(2,30)),this.h&Math.pow(2,30)-1,this.p.nextUint32())}v(){this.h=1024*this.p.nextUint32()+(1023&this.p.nextUint32())}}var ne,re=e=>{if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};Y&&!j(Y.crypto)&&crypto.getRandomValues&&(re=e=>crypto.getRandomValues(e));class oe{constructor(){this.m=new Uint32Array(8),this.k=1/0}nextUint32(){return this.k>=this.m.length&&(re(this.m),this.k=0),this.m[this.k++]}}var se=()=>ae().toString(),ae=()=>(ne||(ne=new ie)).generate(),le=Q("[ConversationsPersistence]"),ue="$conversations_widget_session_id",de="$conversations_ticket_id",he="$conversations_widget_state",ce="$conversations_user_traits";class fe{constructor(e){this.C=null,this._posthog=e}I(){var e,t;return!(!this._posthog.persistence||null!=(e=(t=this._posthog.persistence).isDisabled)&&e.call(t))}getOrCreateWidgetSessionId(){if(this.C)return this.C;if(!this.I()){var e=se();return le.warn("Persistence not available, widget_session_id will not persist",{sessionId:e}),e}try{var t,i,n=null==(t=this._posthog.persistence)?void 0:t.get_property(ue);if(!n)n=se(),null==(i=this._posthog.persistence)||i.register({[ue]:n});return this.C=n,n}catch(e){return le.error("Failed to get/create widget_session_id",e),se()}}clearWidgetSessionId(){if(this.C=null,this.I())try{var e;null==(e=this._posthog.persistence)||e.unregister(ue),le.info("Cleared widget_session_id")}catch(e){le.error("Failed to clear widget_session_id",e)}}saveTicketId(e){if(this.I())try{var t;null==(t=this._posthog.persistence)||t.register({[de]:e}),le.info("Saved ticket ID",{ticketId:e})}catch(e){le.error("Failed to save ticket ID",e)}else le.warn("Persistence not available")}loadTicketId(){if(!this.I())return le.warn("Persistence not available"),null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(de);return t&&le.info("Loaded ticket ID",{ticketId:t}),t||null}catch(e){return le.error("Failed to load ticket ID",e),null}}clearTicketId(){if(this.I())try{var e;null==(e=this._posthog.persistence)||e.unregister(de),le.info("Cleared ticket ID")}catch(e){le.error("Failed to clear ticket ID",e)}else le.warn("Persistence not available")}saveWidgetState(e){if(this.I())try{var t;null==(t=this._posthog.persistence)||t.register({[he]:e})}catch(e){le.error("Failed to save widget state",e)}}loadWidgetState(){if(!this.I())return null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(he);return"open"===t||"closed"===t?t:null}catch(e){return le.error("Failed to load widget state",e),null}}saveUserTraits(e){if(this.I())try{var t;null==(t=this._posthog.persistence)||t.register({[ce]:e}),le.info("Saved user traits",{hasName:!!e.name,hasEmail:!!e.email})}catch(e){le.error("Failed to save user traits",e)}else le.warn("Persistence not available")}loadUserTraits(){if(!this.I())return null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(ce);return t?(le.info("Loaded user traits",{hasName:!!t.name,hasEmail:!!t.email}),t):null}catch(e){return le.error("Failed to load user traits",e),null}}clearUserTraits(){if(this.I())try{var e;null==(e=this._posthog.persistence)||e.unregister(ce),le.info("Cleared user traits")}catch(e){le.error("Failed to clear user traits",e)}}clearAll(){if(this.I())try{var e,t,i;null==(e=this._posthog.persistence)||e.unregister(he),null==(t=this._posthog.persistence)||t.unregister(ce),null==(i=this._posthog.persistence)||i.unregister(de),this.clearWidgetSessionId(),le.info("Cleared all conversation data")}catch(e){le.error("Failed to clear conversation data",e)}}}var pe=e=>({widget:{position:"fixed",bottom:"20px",right:"20px",zIndex:2147483647,fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Roboto", Helvetica, Arial, sans-serif'},buttonContainer:{position:"relative"},button:{width:"50px",height:"50px",borderRadius:"50%",background:e,color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s ease-out, box-shadow 0.2s ease-out"},unreadBadge:{position:"absolute",top:"-4px",right:"-4px",minWidth:"20px",height:"20px",borderRadius:"10px",background:"#ef4444",color:"white",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",padding:"0 5px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",border:"2px solid white",boxSizing:"border-box"},window:{position:"absolute",bottom:0,right:0,background:"white",borderRadius:"10px",boxShadow:"0 10px 25px -3px rgba(0,0,0,0.12), 0 4px 12px -2px rgba(0,0,0,0.10)",display:"flex",flexDirection:"column",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",border:"none"},windowOpen:{width:"400px",height:"600px",maxHeight:"calc(100vh - 100px)"},header:{background:e,color:"white",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},headerTitle:{fontWeight:500,fontSize:"14px"},headerActions:{display:"flex",gap:"4px"},headerButton:{background:"transparent",border:"none",color:"white",cursor:"pointer",padding:"6px 8px",fontSize:"16px",lineHeight:1,borderRadius:"4px",transition:"background 0.2s ease-out",opacity:.9},messages:{flex:1,overflowY:"auto",padding:"14px",display:"flex",flexDirection:"column",gap:"8px",background:"white"},message:{display:"flex",flexDirection:"column",maxWidth:"85%",animation:"fadeIn 0.2s ease-out"},messageCustomer:{alignSelf:"flex-end",alignItems:"flex-end"},messageAgent:{alignSelf:"flex-start",alignItems:"flex-start"},messageAuthor:{fontSize:"10px",color:"#939393",marginBottom:"4px",fontWeight:500},messageContent:{padding:"8px 12px",borderRadius:"8px",fontSize:"12px",lineHeight:1.5,wordWrap:"break-word",whiteSpace:"pre-wrap"},messageContentCustomer:{background:e,color:"white",borderBottomRightRadius:"2px"},messageContentAgent:{background:"white",color:"#020617",border:"1.5px solid #dcdcdc",borderBottomLeftRadius:"2px"},messageTime:{fontSize:"10px",color:"#939393",marginTop:"4px",opacity:.8},typing:{display:"flex",gap:"4px",padding:"10px 14px",alignItems:"center"},typingDot:{width:"6px",height:"6px",borderRadius:"50%",background:"#939393"},error:{padding:"10px 16px",background:"#fee2e2",color:"#991b1b",fontSize:"13px",borderTop:"1px solid #fecaca",borderBottom:"1px solid #fecaca",textAlign:"center",fontWeight:500},inputContainer:{padding:"8px 12px",background:"white",borderTop:"1px solid #dcdcdc",display:"flex",gap:"8px",alignItems:"center",flexShrink:0},input:{flex:1,maxHeight:"120px",fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:1.5,color:"#020617",background:"white",border:"none",outline:"none",transition:"border-color 0.2s ease-out, box-shadow 0.2s ease-out",display:"flex",alignItems:"center",fieldSizing:"content"},sendButton:{width:"33px",height:"33px",borderRadius:"10px",background:e,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease-out",boxShadow:"0 2px 0 rgba(0, 0, 0, 0.045)",fontWeight:700,flexShrink:0},identificationForm:{flex:1,display:"flex",flexDirection:"column",padding:"24px",background:"#eeeded",overflowY:"auto"},formTitle:{fontSize:"18px",fontWeight:600,color:"#020617",marginBottom:"8px"},formDescription:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:1.5},formField:{marginBottom:"16px"},formLabel:{display:"block",fontSize:"13px",fontWeight:500,color:"#020617",marginBottom:"6px"},formInput:{width:"100%",padding:"10px 12px",border:"1px solid #dcdcdc",borderRadius:"6px",fontSize:"14px",fontFamily:"inherit",color:"#020617",background:"white",transition:"border-color 0.2s ease-out, box-shadow 0.2s ease-out",boxSizing:"border-box"},formInputError:{borderColor:"#ef4444"},formError:{fontSize:"12px",color:"#ef4444",marginTop:"4px"},formSubmitButton:{width:"100%",padding:"12px 16px",borderRadius:"6px",background:e,color:"white",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:600,transition:"all 0.2s ease-out",marginTop:"8px"},formOptional:{fontSize:"12px",color:"#939393",fontWeight:400}}),ve=0;function ge(e,t,i,n,o,s){var a,l,u={};for(l in t)"ref"==l?a=t[l]:u[l]=t[l];var d={type:e,props:u,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--ve,__i:-1,__u:0,__source:o,__self:s};if("function"==typeof e&&(a=e.defaultProps))for(l in a)void 0===u[l]&&(u[l]=a[l]);return r.vnode&&r.vnode(d),d}var me=e=>{var{primaryColor:t,handleToggleOpen:i,unreadCount:n=0}=e,r=pe(t),o=n>99?"99+":n.toString();return ge("div",{style:r.widget,children:ge("div",{style:r.buttonContainer,children:[ge("button",{style:r.button,onClick:i,"aria-label":n>0?"Open chat ("+n+" unread)":"Open chat",onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 6px 20px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},children:ge("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:ge("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 13.93 2.6 15.71 3.64 17.18L2.5 21.5L7.04 20.42C8.46 21.28 10.17 21.75 12 21.75C17.52 21.75 22 17.27 22 11.75C22 6.23 17.52 2 12 2Z",fill:"currentColor"})})}),n>0&&ge("div",{style:r.unreadBadge,children:o})]})})},ye=e=>{var{primaryColor:t,inputValue:n,isLoading:r,handleSendMessage:o}=e;return ge("button",{style:i({},pe(t).sendButton,{opacity:!n.trim()||r?.6:1,cursor:!n.trim()||r?"not-allowed":"pointer"}),onClick:o,disabled:!n.trim()||r,"aria-label":"Send message",onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)")},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 0 rgba(0, 0, 0, 0.045)"},children:ge("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:ge("path",{d:"M2 10L18 2L10 18L8 11L2 10Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"})})})},we=e=>{var{primaryColor:t,handleClose:i}=e;return ge("button",{style:pe(t).headerButton,onClick:i,"aria-label":"Close",onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.15)",e.currentTarget.style.opacity="1"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.opacity="0.9"},children:"âœ•"})},xe=Q("[ConversationsWidget]");class be extends y{constructor(e){var i;super(e),i=this,this.S=null,this.M=null,this.T=()=>{this.setState((e=>({state:"open"===e.state?"closed":"open"})))},this.D=()=>{this.setState({state:"closed"})},this.F=e=>{var t=e.target;this.setState({inputValue:t.value})},this.P=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.L())},this.A=e=>{var t=e.target;this.setState({formName:t.value})},this.W=e=>{var t=e.target;this.setState({formEmail:t.value,formEmailError:null})},this.U=e=>{e.preventDefault();var{formEmail:t,formName:i}=this.state,{config:n,onIdentify:r}=this.props;if(!n.requireEmail||t.trim())if(!t.trim()||this.N(t.trim())){var o={};i.trim()&&(o.name=i.trim()),t.trim()&&(o.email=t.trim()),this.setState({userTraits:o,showIdentificationForm:!1}),r&&r(o)}else this.setState({formEmailError:"Please enter a valid email address"});else this.setState({formEmailError:"Email is required"})},this.L=t((function*(){var{inputValue:e}=i.state,t=e.trim();if(t){var n={id:"temp-"+Date.now(),content:t,author_type:"customer",author_name:"You",created_at:(new Date).toISOString(),is_private:!1};i.setState({messages:[...i.state.messages,n],inputValue:"",isLoading:!0,error:null});try{yield i.props.onSendMessage(t),i.setState({isLoading:!1})}catch(e){xe.error("Failed to send message",e),i.setState({isLoading:!1,error:e instanceof Error?e.message:"Failed to send message"}),i.setState((e=>({messages:e.messages.filter((e=>e.id!==n.id))})))}}}));var n=e.initialUserTraits||null,r=this.R(e.config,n);this.state={state:e.initialState||"closed",messages:[],inputValue:"",isLoading:!1,error:null,showIdentificationForm:r,formName:(null==n?void 0:n.name)||"",formEmail:(null==n?void 0:n.email)||"",formEmailError:null,userTraits:n,unreadCount:0}}R(e,t){return e.requireEmail,null==t||!t.email}componentDidMount(){0===this.state.messages.length&&this.props.config.greetingText&&this.B()}componentDidUpdate(e,t){this.state.messages.length!==t.messages.length&&this.$(),this.state.state!==t.state&&this.props.onStateChange&&this.props.onStateChange(this.state.state),"open"===this.state.state&&"open"!==t.state&&(this.O(),this.$())}B(){var e={id:"greeting",content:this.props.config.greetingText||"Hi! How can we help?",author_type:"AI",author_name:"Support",created_at:(new Date).toISOString(),is_private:!1};this.setState({messages:[e]})}$(){this.S&&this.S.scrollIntoView({behavior:"smooth"})}O(){this.M&&this.M.focus()}N(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}H(e){var t=new Date(e),i=(new Date).getTime()-t.getTime(),n=Math.floor(i/6e4);return n<1?"Just now":n<60?n+"m ago":n<1440?Math.floor(n/60)+"h ago":t.toLocaleDateString()}addMessages(e){this.setState((t=>{var i=new Set(t.messages.map((e=>e.id))),n=e.filter((e=>!i.has(e.id)));return n.length>0?{messages:[...t.messages,...n]}:null}))}show(){this.setState({state:"open"})}hide(){this.setState({state:"closed"})}close(){this.setState({state:"closed"})}getUserTraits(){return this.state.userTraits}setUnreadCount(e){this.setState({unreadCount:e})}j(e){var{config:t}=this.props,{formName:n,formEmail:r,formEmailError:o}=this.state,s=t.identificationFormTitle||"Before we start...",a=t.identificationFormDescription||"Please provide your details so we can help you better.",l=!1!==t.collectName;return ge("div",{style:e.identificationForm,children:[ge("div",{style:e.formTitle,children:s}),ge("div",{style:e.formDescription,children:a}),ge("form",{onSubmit:this.U,children:[l&&ge("div",{style:e.formField,children:[ge("label",{style:e.formLabel,children:["Name ",ge("span",{style:e.formOptional,children:"(optional)"})]}),ge("input",{type:"text",style:e.formInput,value:n,onInput:this.A,placeholder:"Your name",autoComplete:"name"})]}),ge("div",{style:e.formField,children:[ge("label",{style:e.formLabel,children:["Email ",!t.requireEmail&&ge("span",{style:e.formOptional,children:"(optional)"})]}),ge("input",{type:"email",style:i({},e.formInput,o?e.formInputError:{}),value:r,onInput:this.W,placeholder:"you@example.com",autoComplete:"email"}),o&&ge("div",{style:e.formError,children:o})]}),ge("button",{type:"submit",style:e.formSubmitButton,onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Start Chat"})]})]})}V(e,t){var n="customer"===e.author_type,r=i({},t.message,n?t.messageCustomer:t.messageAgent),o=i({},t.messageContent,n?t.messageContentCustomer:t.messageContentAgent);return ge("div",{style:r,children:[!n&&e.author_name&&ge("div",{style:t.messageAuthor,children:e.author_name}),ge("div",{style:o,children:e.content}),ge("div",{style:t.messageTime,children:this.H(e.created_at)})]},e.id)}render(){var{config:e}=this.props,{state:t,messages:n,inputValue:r,isLoading:o,error:s,showIdentificationForm:a}=this.state,l=e.color||"#5375ff",u=e.placeholderText||"Type your message...",d=pe(l);if("closed"===t)return ge(me,{primaryColor:l,handleToggleOpen:this.T,unreadCount:this.state.unreadCount});var h=i({},d.window,d.windowOpen);return ge("div",{style:d.widget,children:ge("div",{style:h,children:[ge("div",{style:d.header,children:[ge("div",{style:d.headerTitle,children:ge("span",{children:"Support Chat"})}),ge("div",{style:d.headerActions,children:ge(we,{primaryColor:l,handleClose:this.D})})]}),a?this.j(d):ge(m,{children:[ge("div",{style:d.messages,children:[n.map((e=>this.V(e,d))),o&&ge("div",{style:i({},d.message,d.messageAgent),children:ge("div",{style:i({},d.messageContent,d.messageContentAgent,d.typing),children:[ge("span",{style:d.typingDot}),ge("span",{style:i({},d.typingDot,{animationDelay:"0.2s"})}),ge("span",{style:i({},d.typingDot,{animationDelay:"0.4s"})})]})}),ge("div",{ref:e=>this.S=e})]}),s&&ge("div",{style:d.error,children:s}),ge("div",{style:d.inputContainer,children:[ge("textarea",{ref:e=>this.M=e,style:d.input,placeholder:u,value:r,onInput:this.F,onKeyPress:this.P,rows:1,disabled:o}),ge(ye,{primaryColor:l,inputValue:r,isLoading:o,handleSendMessage:this.L})]})]})]})})}}var _e={};function ke(e,t,i){if(!(e=>j(e)||(e=>null===e)(e))(e)){if(H(e))return function(e,t,i){if(H(e))if(q&&e.forEach===q)e.forEach(t,i);else if("length"in e&&e.length===+e.length)for(var n=0,r=e.length;n<r;n++)if(n in e&&t.call(i,e[n],n)===_e)return}(e,t,i);if((e=>e instanceof FormData)(e)){for(var n of e.entries())if(t.call(i,n[1],n[0])===_e)return}else for(var r in e)if(B.call(e,r)&&t.call(i,e[r],r)===_e)return}}var Ce=function(e,t){var i,n;void 0===t&&(t="&");var r=[];return ke(e,(function(e,t){j(e)||j(t)||"undefined"===t||(i=encodeURIComponent((e=>e instanceof File)(e)?e.name:e.toString()),n=encodeURIComponent(t),r[r.length]=n+"="+i)})),r.join(t)},Ie=Q("[ConversationsManager]"),Se="ph-conversations-widget-container";class Ee{constructor(e,i){var n=this;this.Y=null,this.G=null,this.q=null,this.K=null,this.X=null,this.Z=!1,this.J=null,this.ee=0,this.te=e=>{this.ie.saveUserTraits(e),this._posthog.capture("$conversations_user_identified",{hasName:!!e.name,hasEmail:!!e.email})},this.L=function(){var e=t((function*(e){var t,i=(null==(t=n.Y)?void 0:t.getUserTraits())||void 0,r=!n.q;try{var o=yield n.ne(e,n.q||void 0,i);n.q||(n.q=o.ticket_id,n.ie.saveTicketId(o.ticket_id),Ie.info("New ticket created",{ticketId:o.ticket_id})),n._posthog.capture("$conversations_message_sent",{ticketId:o.ticket_id,isNewTicket:r,messageLength:e.length}),n.X=o.created_at,setTimeout((()=>n.re()),1e3)}catch(e){throw Ie.error("Failed to send message",e),e}}));return function(t){return e.apply(this,arguments)}}(),this.oe=e=>{Ie.info("Widget state changed",{state:e}),this._posthog.capture("$conversations_widget_state_changed",{state:e,ticketId:this.q}),this.ie.saveWidgetState(e),"open"===e&&this.ee>0&&this.q&&this.se()},this.re=t((function*(){if(!n.Z&&n.q){n.Z=!0;try{yield n.ae()}finally{n.Z=!1}}})),this._posthog=i,this.le=e,this.ie=new fe(i),this.ue=this.ie.getOrCreateWidgetSessionId(),Ie.info("ConversationsManager initialized",{config:e,widgetSessionId:this.ue}),this.de()}ne(e,t,i){var n=this.le.token;return new Promise(((r,o)=>{var s,a=this._posthog.get_distinct_id(),l=(null==(s=this._posthog.persistence)?void 0:s.props)||{},u=(null==i?void 0:i.name)||l.$name||l.name||null,d=(null==i?void 0:i.email)||l.$email||l.email||null,h={widget_session_id:this.ue,distinct_id:a,message:e.trim(),traits:{name:u,email:d},ticket_id:t||null};this._posthog._send_request({url:this._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/message"),method:"POST",data:h,headers:{"X-Conversations-Token":n},callback:e=>{if(429!==e.statusCode){if(200!==e.statusCode&&201!==e.statusCode){var t,i,n=(null==(t=e.json)?void 0:t.detail)||(null==(i=e.json)?void 0:i.message)||"Failed to send message";return Ie.error("Failed to send message",{status:e.statusCode}),void o(new Error(n))}if(e.json){var s=e.json;r(s)}else o(new Error("Invalid response from server"))}else o(new Error("Too many requests. Please wait before trying again."))}})}))}he(e,t){var i=this.le.token;return new Promise(((n,r)=>{var o={widget_session_id:this.ue,limit:"50"};t&&(o.after=t),this._posthog._send_request({url:this._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/messages/"+e+"?"+Ce(o)),method:"GET",headers:{"X-Conversations-Token":i},callback:e=>{if(429!==e.statusCode){if(200!==e.statusCode){var t,i,o=(null==(t=e.json)?void 0:t.detail)||(null==(i=e.json)?void 0:i.message)||"Failed to fetch messages";return Ie.error("Failed to fetch messages",{status:e.statusCode}),void r(new Error(o))}if(e.json){var s=e.json;n(s)}else r(new Error("Invalid response from server"))}else r(new Error("Too many requests. Please wait before trying again."))}})}))}ce(e){var t=this.le.token;return new Promise(((i,n)=>{Ie.info("Marking messages as read",{ticketId:e}),this._posthog._send_request({url:this._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/messages/"+e+"/read"),method:"POST",data:{widget_session_id:this.ue},headers:{"X-Conversations-Token":t},callback:e=>{if(429!==e.statusCode){if(200!==e.statusCode){var t,r,o=(null==(t=e.json)?void 0:t.detail)||(null==(r=e.json)?void 0:r.message)||"Failed to mark messages as read";return Ie.error("Failed to mark messages as read",{status:e.statusCode}),void n(new Error(o))}if(e.json){var s=e.json;i(s)}else n(new Error("Invalid response from server"))}else n(new Error("Too many requests. Please wait before trying again."))}})}))}de(){if(X&&Y){this.q=this.ie.loadTicketId(),Ie.info("Loaded ticket ID from storage",{ticketId:this.q});var e="closed";"open"===this.ie.loadWidgetState()&&(e="open");var t=this.fe();this.pe(e,t),this._posthog.capture("$conversations_widget_loaded",{hasExistingTicket:!!this.q,initialState:e,hasUserTraits:!!t}),this.q&&this.ae(),this.ve(),this.ge()}else Ie.info("Conversations not available: Document or window not available")}fe(){var e,t=(null==(e=this._posthog.persistence)?void 0:e.props)||{},i=t.$name||t.name,n=t.$email||t.email;if(i||n)return{name:i||void 0,email:n||void 0};var r=this.ie.loadUserTraits();return r&&(r.name||r.email)?r:null}se(){var e=this;return t((function*(){if(e.q)try{var t,i=yield e.ce(e.q);e.ee=i.unread_count,null==(t=e.Y)||t.setUnreadCount(0),Ie.info("Messages marked as read",{unreadCount:i.unread_count})}catch(e){Ie.error("Failed to mark messages as read",e)}}))()}ae(){var e=this;return t((function*(){if(e.q)try{var t,i=yield e.he(e.q,e.X||void 0);if(V(i.unread_count))e.ee=i.unread_count,null==(t=e.Y)||t.setUnreadCount(i.unread_count),i.unread_count>0&&e.me()&&e.se();if(i.messages.length>0){var n;null==(n=e.Y)||n.addMessages(i.messages);var r=i.messages[i.messages.length-1];e.X=r.created_at}}catch(e){Ie.error("Failed to load messages",e)}}))()}me(){return"open"===this.ie.loadWidgetState()}ve(){this.K||(this.re(),this.K=null==Y?void 0:Y.setInterval((()=>{this.re()}),5e3),Ie.info("Started polling for messages"))}ye(){this.K&&(null==Y||Y.clearInterval(this.K),this.K=null,Ie.info("Stopped polling for messages"))}ge(){this.J=this._posthog.on("eventCaptured",(e=>{if("$identify"===e.event){var t,i,n=null==(t=e.properties)?void 0:t.distinct_id,r=null==(i=e.properties)?void 0:i.$anon_distinct_id;r&&n&&r!==n&&(Ie.info("Detected identify event",{oldDistinctId:r,newDistinctId:n}),this.we(r,n))}}))}we(e,t){Ie.info("User identified, conversation continues with same widget_session_id",{ticketId:this.q,widgetSessionId:this.ue,oldDistinctId:e,newDistinctId:t}),this._posthog.capture("$conversations_identity_changed",{hadExistingTicket:!!this.q})}enable(){var e;null==(e=this.Y)||e.show()}disable(){var e;null==(e=this.Y)||e.hide()}sendMessage(e){this.L(e)}destroy(){this.ye(),this.J&&(this.J(),this.J=null),this.G&&(U(null,this.G),this.G.remove(),this.G=null),this.Y=null,Ie.info("Widget destroyed")}reset(){this.ie.clearAll(),this.q=null,this.X=null,this.ee=0,this.destroy(),Ie.info("Conversations reset")}pe(e,t){if(X){var i=X.getElementById(Se);if(!i){if(!X.body)return void Ie.info("Conversations widget not rendered: Document body not available yet");(i=X.createElement("div")).id=Se,X.body.appendChild(i)}this.G=i,U(ge(be,{ref:e=>{this.Y=e},config:this.le,initialState:e,initialUserTraits:t,onSendMessage:this.L,onStateChange:this.oe,onIdentify:this.te}),i)}else Ie.info("Conversations widget not rendered: Document not available")}}function Me(e,t){return Ie.info("initConversations called",{hasConfig:!!e,hasPosthog:!!t}),new Ee(e,t)}Z.__PosthogExtensions__=Z.__PosthogExtensions__||{},Z.__PosthogExtensions__.initConversations=Me}();
//# sourceMappingURL=conversations.js.map
